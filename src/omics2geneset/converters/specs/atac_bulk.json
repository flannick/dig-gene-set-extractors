{
  "name": "atac_bulk",
  "description": "Bulk ATAC-seq peaks and per-peak weights mapped to compact gene programs",
  "inputs": [
    {
      "name": "peaks",
      "type": "bed_or_narrowPeak_gz",
      "description": "Peak intervals; may include score column for weights",
      "required": true
    },
    {
      "name": "gtf",
      "type": "gtf",
      "description": "Gene annotation with gene features",
      "required": true
    },
    {
      "name": "peak_weights_tsv",
      "type": "tsv_optional",
      "description": "Optional explicit (chrom,start,end,weight) override table",
      "required": false
    }
  ],
  "parameters": [
    {"name": "link_method", "type": "string", "default": "promoter_overlap", "enum": ["promoter_overlap", "nearest_tss", "distance_decay"], "help": "Peak-to-gene linkage strategy"},
    {"name": "promoter_upstream_bp", "type": "int", "default": 2000, "help": "Promoter upstream window for promoter_overlap"},
    {"name": "promoter_downstream_bp", "type": "int", "default": 500, "help": "Promoter downstream window for promoter_overlap"},
    {"name": "max_distance_bp", "type": "int_or_none", "default": null, "help": "Distance cap for nearest/distance modes; resolved default by link_method"},
    {"name": "decay_length_bp", "type": "int", "default": 50000, "help": "Exponential decay length for distance_decay"},
    {"name": "max_genes_per_peak", "type": "int", "default": 5, "help": "Maximum linked genes per peak for distance_decay"},
    {"name": "peaks_weight_column", "type": "int", "default": 5, "help": "1-based score column in peaks file"},
    {"name": "peak_weight_transform", "type": "string", "default": "abs", "enum": ["signed", "abs", "positive", "negative"], "help": "Transform applied to peak weights prior to scoring"},
    {"name": "select", "type": "string", "default": "top_k", "enum": ["none", "top_k", "quantile", "threshold"], "help": "Method for selecting the compact output gene program"},
    {"name": "top_k", "type": "int", "default": 200, "help": "Number of genes kept when select=top_k"},
    {"name": "quantile", "type": "float", "default": 0.01, "help": "Top fraction kept when select=quantile"},
    {"name": "min_score", "type": "float", "default": 0.0, "help": "Score threshold when select=threshold"},
    {"name": "emit_full", "type": "bool", "default": true, "help": "If true, also write geneset.full.tsv with all nonzero scores"},
    {"name": "normalize", "type": "string", "default": "within_set_l1", "enum": ["none", "l1", "within_set_l1"], "help": "Weight normalization mode"}
  ],
  "outputs": [
    {"name": "geneset.tsv", "description": "Selected compact gene program with columns gene_id, score, rank, weight"},
    {"name": "geneset.full.tsv", "description": "Optional full score table for all nonzero genes"},
    {"name": "geneset.meta.json", "description": "Run metadata and provenance validated against schema"}
  ]
}
